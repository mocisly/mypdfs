\ProvidesPackage{env}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%       a fun box pkg       %
%           by em           %
%                           %
% put this cmd in main file %
%      \usepackage{env}     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%  the following are the environment names for various boxes:
%      -Proof:        \begin{pf}
%      -Theorem:      \begin{thm}
%      -Definition:   \begin{defn}
%      -Lemma:        \begin{lm}
%      -Corollary:    \begin{crll}
%      -Question:     \begin{qu}
%      -Solution:     \begin{soln}
%      -Example:      \begin{xmp}
%      -Exercise:     \begin{exr}


% required packages
\usepackage{environ}
\usepackage{pgfkeys}
\usepackage{tcolorbox}

% tcolorbox settings
\tcbuselibrary{breakable}
\tcbuselibrary{skins}

% custom colours used
\definecolor{theorem}{HTML}{FF0000}
\definecolor{definition}{HTML}{800080}
\definecolor{proof}{HTML}{00FF00}
\definecolor{solution}{HTML}{00B9F2}
\definecolor{lemma}{HTML}{FF8000}
\definecolor{corollary}{HTML}{FF8178}
\definecolor{question}{HTML}{0000FF}
\definecolor{example}{HTML}{C663F7}
\definecolor{exercise}{HTML}{129F57}

\definecolor{bg}{HTML}{293133}

% custom counters
\newcounter{thm}
\newcounter{defn}
\newcounter{qu}
\newcounter{exr}
\counterwithin{thm}{subsection}
\counterwithin{defn}{subsection}
\counterwithin{qu}{subsection}
\counterwithin{exr}{subsection}

% settings for boxes
\pgfkeys{
/myenv/.is family, /myenv,
title/.estore in = \mytitle,
source/.estore in = \mysource,
type/.estore in = \mytype,
num/.estore in = \mynum,
thmnum/.estore in = \thmnum,
defnnum/.estore in = \defnnum,
qunum/.estore in = \qunum,
exrnum/.estore in = \exrnum,
default/.style = {
    title = \empty, source = \empty, type = \empty, num = \empty, thmnum = 0, defnnum = 0, qunum = 1, exrnum = 0
    },
settitle/.code={
    \ifx\mytitle\empty
    \else \pgfkeyssetevalue{\mytitle}{: \mytitle}
    \fi
    },
setsource/.code={
    \ifx\mysource\empty
    \else \pgfkeyssetevalue{\mysource}{Source: \mysource}
    \fi
    },
setthmnum/.code={
    \ifx\mynum\empty
        \pgfkeyssetevalue{\thmnum}{\thethm}
    \else
        \pgfkeyssetevalue{\thmnum}{\mynum}
    \fi
    },
setdefnnum/.code={
    \ifx\mynum\empty
        \pgfkeyssetevalue{\defnnum}{\thedefn}
    \else
        \pgfkeyssetevalue{\defnnum}{\mynum}
    \fi
    },
setqunum/.code={
    \ifx\mynum\empty
        \pgfkeyssetevalue{\qunum}{\thequ}
    \else
        \pgfkeyssetevalue{\qunum}{\mynum}
    \fi
    },
setexrnum/.code={
    \ifx\mynum\empty
        \pgfkeyssetevalue{\exrnum}{\theexr}
    \else
        \pgfkeyssetevalue{\exrnum}{\mynum}
    \fi
    },
}
% \counterwithin*{section}{part}

% theorem environment
\NewEnviron{thm}[1][]{
\vspace{-0.175in}
\stepcounter{thm}
\pgfkeys{/myenv, default, type=Theorem, #1, settitle, setthmnum}
\begin{mybox}{{\mytype} \pgfkeysvalueof{\thmnum}\pgfkeysvalueof{\mytitle}}{red}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
\vspace{-0.175in}
}{}

% definition environment
\NewEnviron{defn}[1][]{
\vspace{-0.175in}
\stepcounter{defn}
\pgfkeys{/myenv, default, type=Definition, #1, settitle, setdefnnum}
\begin{mybox}{{\mytype} \pgfkeysvalueof{\defnnum}\pgfkeysvalueof{\mytitle}}{violet}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
\vspace{-0.175in}
}{}

% proof environment
\NewEnviron{pf}[1][]{
\vspace{-0.175in}
\pgfkeys{/myenv, default, type=Proof, #1, settitle, setsource}
\begin{mybox}{{\mytype}\pgfkeysvalueof{\mytitle}.}{green}
    \raggedright \textcolor{\IfDarkModeTF{white}{black}}{\BODY} \ \\[-8px]
    \raggedleft $\blacksquare$
\end{mybox}
\footnotesize \begin{flushright} \vspace*{-0.5cm}
    \pgfkeysvalueof{\mysource} \normalsize \end{flushright}
\vspace{-0.175in}
}{}

% solution environment
\NewEnviron{soln}[1][]{
\vspace{-0.175in}
\pgfkeys{/myenv, default, type=Solution, #1, settitle, setsource}
\begin{mybox}{{\mytype}\pgfkeysvalueof{\mytitle}.}{cyan}
    \raggedright \textcolor{\IfDarkModeTF{white}{black}}{\BODY} \ \\[-8px]
    \raggedleft $ \twemoji{black cat} $ 
\end{mybox}
\footnotesize \begin{flushright} \vspace*{-0.5cm}
    \pgfkeysvalueof{\mysource} \normalsize \end{flushright}
\vspace{-0.175in}
}{}

% lemma environment
\NewEnviron{lm}[1][]{
\vspace{-0.175in}
\pgfkeys{/myenv, default, type=Lemma, #1, settitle, setsource}
\begin{mybox}{{\mytype}\pgfkeysvalueof{\mytitle}}{orange}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
\footnotesize \begin{flushright} \vspace*{-0.5cm}
    \pgfkeysvalueof{\mysource} \normalsize \end{flushright}
\vspace{-0.175in}
}{}

% corollary environment
\NewEnviron{crll}[1][]{
\vspace{-0.175in}
\pgfkeys{/myenv, default, type=Corollary, #1, settitle, setsource}
\begin{mybox}{{\mytype}\pgfkeysvalueof{\mytitle}}{corollary}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
\footnotesize \begin{flushright} \vspace*{-0.5cm}
    \pgfkeysvalueof{\mysource} \normalsize \end{flushright}
\vspace{-0.175in}
}{}

% question environment
\NewEnviron{qu}[1][]{
\vspace{-0.175in}
\stepcounter{qu}
\pgfkeys{/myenv, default, type=Question, #1, settitle, setsource, setqunum}
\begin{mybox}{{\mytype} \pgfkeysvalueof{\qunum}\pgfkeysvalueof{\mytitle}}{blue}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
\footnotesize \begin{flushright} \vspace*{-0.5cm}
    \pgfkeysvalueof{\mysource} \normalsize \end{flushright}
\vspace{-0.175in}
}{}

% example environment
\NewEnviron{xmp}[1][]{
\vspace{-0.175in}
\pgfkeys{/myenv, default, type=Example, #1, settitle, setsource}
\begin{mybox}{{\mytype}\pgfkeysvalueof{\mytitle}}{example}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
\footnotesize \begin{flushright} \vspace*{-0.5cm}
    \pgfkeysvalueof{\mysource} \normalsize \end{flushright}
\vspace{-0.175in}
}{}

% exercise environment
\NewEnviron{exr}[1][]{
\vspace{-0.175in}
\stepcounter{exr}
\pgfkeys{/myenv, default, type=Exercise, #1, settitle, setsource, setexrnum}
\begin{mybox}{{\mytype} \pgfkeysvalueof{\exrnum}\pgfkeysvalueof{\mytitle}}{ForestGreen}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
\footnotesize \begin{flushright} \vspace*{-0.5cm}
    \pgfkeysvalueof{\mysource} \normalsize \end{flushright}
\vspace{-0.175in}
}{}

% base tcolorbox used
\newtcolorbox{mybox}[3][]{
colback=\IfDarkModeTF{#3!10!bg}{#3!10},
colframe=\IfDarkModeTF{#3!65!bg}{#3!65},
fonttitle=\bfseries,
coltitle=\IfDarkModeTF{white!70!bg}{black!70},
enhanced,
top=6.5mm,
attach boxed title to top left={yshift=-3mm,xshift=8mm},
beforeafter skip=2.5em,
breakable,
boxed title style={
frame hidden,
opacityback=0,
},
underlay boxed title={
\path[draw=\IfDarkModeTF{#3!65!bg}{#3!65}, line width=0.5mm, fill=\IfDarkModeTF{#3!20!bg}{#3!20}]
([xshift=-3mm,yshift=-.5mm]title.south west) to[out=0, in=-90] 
([xshift=1.25mm]title.west) to[out=90, in=0] 
([xshift=-3mm,yshift=.5mm]title.north west) |- 
([xshift=-3mm,yshift=.5mm]title.north east) to[out=0, in=90] 
(title.east) to[out=-90, in=0]
([xshift=-3mm,yshift=-.5mm]title.south east) to
([xshift=-3mm,yshift=-.5mm]title.south west);
},
title={#2},#1}

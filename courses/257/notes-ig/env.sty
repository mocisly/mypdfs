\ProvidesPackage{env}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%       a fun box pkg       %
%           by em           %
%                           %
% put this cmd in main file %
%      \usepackage{env}     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%  the following are the environment names for various boxes:
%      -Proof:        \begin{pf}
%      -Theorem:      \begin{thm}
%      -Definition:   \begin{defn}
%      -Lemma:        \begin{lm}
%      -Corollary:    \begin{crll}
%      -Question:     \begin{qu}
%      -Solution:     \begin{soln}
%      -Example:      \begin{xmp}
%      -Exercise:     \begin{exr}


% required packages
\usepackage{environ}
\usepackage{pgfkeys}
\usepackage{tcolorbox}

% tcolorbox settings
\tcbuselibrary{breakable}
\tcbuselibrary{skins}

% custom colours used
\definecolor{corollary}{HTML}{ff8178}
\definecolor{example}{HTML}{c663f7}
\definecolor{exercise}{HTML}{007516}

% settings for boxes
\pgfkeys{
/myenv/.is family, /myenv,
title/.estore in = \mytitle,
source/.estore in = \mysource,
type/.estore in = \mytype,
default/.style = {
    title = \empty, source = \empty, type = \empty
    },
settitle/.code={
    \ifx\mytitle\empty
    \else \pgfkeyssetevalue{\mytitle}{: \mytitle}
    \fi
    },
setsource/.code={
    \ifx\mysource\empty
    \else \pgfkeyssetevalue{\mysource}{Source: \mysource}
    \fi
    },
}

% custom counters
\newcounter{thm}
\newcounter{defn}
\newcounter{qu}
\newcounter{exr}
\counterwithin{thm}{subsection}
\counterwithin{defn}{subsection}
\counterwithin{qu}{subsection}
\counterwithin{exr}{subsection}

% \counterwithin*{section}{part}

% theorem environment
\NewEnviron{thm}[1][]{
\pgfkeys{/myenv, default, type=Theorem, #1, settitle}
\vspace{-0.175in}
\stepcounter{thm}
\begin{mybox}{{\mytype} {\thethm}\pgfkeysvalueof{\mytitle}}{red}
    \BODY
\end{mybox}
\vspace{-0.175in}
}{}

% definition environment
\NewEnviron{defn}[1][]{
\pgfkeys{/myenv, default, type=Definition, #1, settitle}
\vspace{-0.175in}
\stepcounter{defn}
\begin{mybox}{{\mytype} {\thedefn}\pgfkeysvalueof{\mytitle}}{violet}
    \BODY
\end{mybox}
\vspace{-0.175in}
}{}

% proof environment
\NewEnviron{pf}[1][]{
\pgfkeys{/myenv, default, type=Proof, #1, settitle, setsource}
\vspace{-0.175in}
\begin{mybox}{{\mytype}\pgfkeysvalueof{\mytitle}.}{green}
    \raggedright \BODY \ \\[-8px]
    \raggedleft $\blacksquare$
\end{mybox}
\footnotesize \begin{flushright} \vspace*{-0.5cm}
    \pgfkeysvalueof{\mysource} \normalsize \end{flushright}
\vspace{-0.175in}
}{}

% solution environment
\NewEnviron{soln}[1][]{
\pgfkeys{/myenv, default, type=Solution, #1, settitle, setsource}
\vspace{-0.175in}
\begin{mybox}{{\mytype}\pgfkeysvalueof{\mytitle}.}{cyan}
     \raggedright \BODY \ \\[-8px]
     \raggedleft $ \twemoji{black cat} $ 
\end{mybox}
\footnotesize \begin{flushright} \vspace*{-0.5cm}
    \pgfkeysvalueof{\mysource} \normalsize \end{flushright}
\vspace{-0.175in}
}{}

% lemma environment
\NewEnviron{lm}[1][]{
\pgfkeys{/myenv, default, type=Lemma, #1, settitle, setsource}
\vspace{-0.175in}
\begin{mybox}{{\mytype}\pgfkeysvalueof{\mytitle}}{orange}
    \BODY
\end{mybox}
\footnotesize \begin{flushright} \vspace*{-0.5cm}
    \pgfkeysvalueof{\mysource} \normalsize \end{flushright}
\vspace{-0.175in}
}{}

% corollary environment
\NewEnviron{crll}[1][]{
\pgfkeys{/myenv, default, type=Corollary, #1, settitle, setsource}
\vspace{-0.175in}
\begin{mybox}{{\mytype}\pgfkeysvalueof{\mytitle}}{corollary}
    \BODY
\end{mybox}
\footnotesize \begin{flushright} \vspace*{-0.5cm}
    \pgfkeysvalueof{\mysource} \normalsize \end{flushright}
\vspace{-0.175in}
}{}

% question environment
\NewEnviron{qu}[1][]{
\pgfkeys{/myenv, default, type=Question, #1, settitle, setsource}
\vspace{-0.175in}
\stepcounter{qu}
\begin{mybox}{{\mytype} {\thequ}\pgfkeysvalueof{\mytitle}}{blue}
    \BODY
\end{mybox}
\footnotesize \begin{flushright} \vspace*{-0.5cm}
    \pgfkeysvalueof{\mysource} \normalsize \end{flushright}
\vspace{-0.175in}
}{}

% example environment
\NewEnviron{xmp}[1][]{
\pgfkeys{/myenv, default, type=Example, #1, settitle, setsource}
\vspace{-0.175in}
\begin{mybox}{{\mytype}\pgfkeysvalueof{\mytitle}}{example}
    \BODY
\end{mybox}
\footnotesize \begin{flushright} \vspace*{-0.5cm}
    \pgfkeysvalueof{\mysource} \normalsize \end{flushright}
\vspace{-0.175in}
}{}

% exercise environment
\NewEnviron{exr}[1][]{
\pgfkeys{/myenv, default, type=Exercise, #1, settitle, setsource}
\vspace{-0.175in}
\stepcounter{exr}
\begin{mybox}{{\mytype} {\theexr}\pgfkeysvalueof{\mytitle}}{ForestGreen}
    \BODY
\end{mybox}
\footnotesize \begin{flushright} \vspace*{-0.5cm}
    \pgfkeysvalueof{\mysource} \normalsize \end{flushright}
\vspace{-0.175in}
}{}

% base tcolorbox used
\newtcolorbox{mybox}[3][]{
colback=#3!10,
colframe=#3!65,
fonttitle=\bfseries,
coltitle=black!70,
enhanced,
top=6.5mm,
attach boxed title to top left={yshift=-3mm,xshift=8mm},
beforeafter skip=2.5em,
breakable,
boxed title style={
frame hidden,
opacityback=0,
},
underlay boxed title={
\path[draw=#3!65, line width=0.5mm, fill=#3!20]
([xshift=-3mm,yshift=-.5mm]title.south west) to[out=0, in=-90] 
([xshift=1.25mm]title.west) to[out=90, in=0] 
([xshift=-3mm,yshift=.5mm]title.north west) |- 
([xshift=-3mm,yshift=.5mm]title.north east) to[out=0, in=90] 
(title.east) to[out=-90, in=0]
([xshift=-3mm,yshift=-.5mm]title.south east) to
([xshift=-3mm,yshift=-.5mm]title.south west);
},
title={#2},#1}

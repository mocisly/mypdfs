\ProvidesPackage{env}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%       a fun box pkg       %
%           by em           %
%                           %
% put this cmd in main file %
%      \usepackage{env}     %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%  the following are the environment names for various boxes:
%      -Proof:        \begin{pf}
%      -Proposition:  \begin{prop}
%      -Definition:   \begin{defn}
%      -Lemma:        \begin{lm}
%      -Corollary:    \begin{crll}
%      -Question:     \begin{qu}
%      -Solution:     \begin{soln}
%      -Example:      \begin{xmp}
%      -Exercise:     \begin{exr}


% required packages
\usepackage{environ}
\usepackage{pgfkeys}
\usepackage{tcolorbox}

% tcolorbox settings
\tcbuselibrary{breakable}
\tcbuselibrary{skins}

% custom colours used
\definecolor{prop}{HTML}{ff0000}
\definecolor{defn}{HTML}{800080}
\definecolor{pf}{HTML}{00ff00}
\definecolor{soln}{HTML}{00b9f2}
\definecolor{lm}{HTML}{ff8000}
\definecolor{crll}{HTML}{ff66bb}
\definecolor{qu}{HTML}{0000ff}
\definecolor{xmp}{HTML}{c663f7}
\definecolor{exr}{HTML}{129f57}

\definecolor{bg}{HTML}{293133}

% custom counter
\newcounter{box}
\counterwithin{box}{subsection}

% settings for boxes
\pgfkeys{
/myenv/.is family, /myenv,
title/.estore in = \mytitle,
source/.estore in = \mysource,
type/.estore in = \mytype,
num/.estore in = \mynum,
boxnum/.estore in = \boxnum,
default/.style = {
    title = \empty, source = \empty, type = \empty, num = \empty, boxnum = 0
    },
settitle/.code={
    \ifx\mytitle\empty
    \else \pgfkeyssetevalue{\mytitle}{: \mytitle}
    \fi
    },
setsource/.code={
    \ifx\mysource\empty
    \else \pgfkeyssetevalue{\mysource}{Source: \mysource}
    \fi
    },
setboxnum/.code={
    \ifx\mynum\empty
        \pgfkeyssetevalue{\boxnum}{\thebox}
    \else
        \pgfkeyssetevalue{\boxnum}{\mynum}
    \fi
    },
}

% theorem environment
\NewEnviron{prop}[1][]{
\stepcounter{box}
\pgfkeys{/myenv, default, type=Proposition, #1, settitle, setboxnum}
\begin{mybox}{{\mytype} \pgfkeysvalueof{\boxnum}\pgfkeysvalueof{\mytitle}}{prop}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
}{}
\NewEnviron{thm}[1][]{
\stepcounter{box}
\pgfkeys{/myenv, default, type=Theorem, #1, settitle, setboxnum}
\begin{mybox}{{\mytype} \pgfkeysvalueof{\boxnum}\pgfkeysvalueof{\mytitle}}{prop}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
}{}

% definition environment
\NewEnviron{defn}[1][]{
\stepcounter{box}
\pgfkeys{/myenv, default, type=Definition, #1, settitle, setboxnum}
\begin{mybox}{{\mytype} \pgfkeysvalueof{\boxnum}\pgfkeysvalueof{\mytitle}}{defn}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
}{}

% proof environment
\NewEnviron{pf}[1][]{
\pgfkeys{/myenv, default, type=Proof, #1, settitle, setsource}
\footnotesize \begin{flushright} \vspace*{-0.2cm}
    \pgfkeysvalueof{\mysource} \end{flushright}
\normalsize \vspace{-1.3cm}
\begin{mybox}{{\mytype}\pgfkeysvalueof{\mytitle}.}{pf}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY} \ \\[-8px]
    \tcblower \IfDarkModeTF{\textcolor{white}{$\blacksquare$}}{$\blacksquare$}
\end{mybox}
}{}

% solution environment
\NewEnviron{soln}[1][]{
\pgfkeys{/myenv, default, type=Solution, #1, settitle, setsource}
\footnotesize \begin{flushright} \vspace*{-0.2cm}
    \pgfkeysvalueof{\mysource} \end{flushright}
\normalsize \vspace{-1.3cm}
\begin{mybox}{{\mytype}\pgfkeysvalueof{\mytitle}.}{soln}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY} \ \\[-8px]
    \tcblower \IfDarkModeTF{$\twemoji{mouse}$}{$\twemoji{black cat}$}
\end{mybox}
}{}

% lemma environment
\NewEnviron{lm}[1][]{
\stepcounter{box}
\pgfkeys{/myenv, default, type=Lemma, #1, settitle, setsource, setboxnum}
\footnotesize \begin{flushright} \vspace*{-0.2cm}
    \pgfkeysvalueof{\mysource} \end{flushright}
\normalsize \vspace{-1.3cm}
\begin{mybox}{{\mytype} \pgfkeysalueof{\boxnum}\pgfkeysvalueof{\mytitle}}{lm}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
}{}

% corollary environment
\NewEnviron{crll}[1][]{
\stepcounter{box}
\pgfkeys{/myenv, default, type=Corollary, #1, settitle, setsource, setboxnum}
\footnotesize \begin{flushright} \vspace*{-0.2cm}
    \pgfkeysvalueof{\mysource} \end{flushright}
\normalsize \vspace{-1.3cm}
\begin{mybox}{{\mytype} \pgfkeysvalueof{\boxnum}\pgfkeysvalueof{\mytitle}}{crll}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
}{}

% question environment
\NewEnviron{qu}[1][]{
\stepcounter{box}
\pgfkeys{/myenv, default, type=Question, #1, settitle, setsource, setboxnum}
\footnotesize \begin{flushright} \vspace*{-0.2cm}
    \pgfkeysvalueof{\mysource} \end{flushright}
\normalsize \vspace{-1.3cm}
\begin{mybox}{{\mytype} \pgfkeysvalueof{\boxnum}\pgfkeysvalueof{\mytitle}}{qu}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
}{}

% example environment
\NewEnviron{xmp}[1][]{
\stepcounter{box}
\pgfkeys{/myenv, default, type=Example, #1, settitle, setsource, setboxnum}
\footnotesize \begin{flushright} \vspace*{-0.2cm}
    \pgfkeysvalueof{\mysource} \end{flushright}
\normalsize \vspace{-1.3cm}
\begin{mybox}{{\mytype} \pgfkeysvalueof{\boxnum}\pgfkeysvalueof{\mytitle}}{xmp}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
}{}

% exercise environment
\NewEnviron{exr}[1][]{
\stepcounter{box}
\pgfkeys{/myenv, default, type=Exercise, #1, settitle, setsource, setboxnum}
\footnotesize \begin{flushright} \vspace*{-0.2cm}
    \pgfkeysvalueof{\mysource} \end{flushright}
\normalsize \vspace{-1.3cm}
\begin{mybox}{{\mytype} \pgfkeysvalueof{\boxnum}\pgfkeysvalueof{\mytitle}}{exr}
    \textcolor{\IfDarkModeTF{white}{black}}{\BODY}
\end{mybox}
}{}

% base tcolorbox used
\newtcolorbox{mybox}[3][]{
colback=\IfDarkModeTF{#3!15!bg}{#3!10},
colframe=\IfDarkModeTF{#3!75!bg}{#3!65},
fonttitle=\bfseries,
coltitle=\IfDarkModeTF{white!90!bg}{black!70},
enhanced,
top=6mm,
left=3mm,
right=3mm,
middle=0mm,
attach boxed title to top left={yshift=-3mm,xshift=8mm},
before skip=1em,
after skip=1em,
use color stack,
breakable,
boxed title style={
frame hidden,
opacityback=0,
},
underlay boxed title={
\path[draw=\IfDarkModeTF{#3!75!bg}{#3!65}, line width=0.5mm, fill=\IfDarkModeTF{#3!28!bg}{#3!20}]
([xshift=-3mm,yshift=-.5mm]title.south west) to[out=0, in=-90] 
([xshift=1.25mm]title.west) to[out=90, in=0] 
([xshift=-3mm,yshift=.5mm]title.north west) |- 
([xshift=-3mm,yshift=.5mm]title.north east) to[out=0, in=90] 
(title.east) to[out=-90, in=0]
([xshift=-3mm,yshift=-.5mm]title.south east) to
([xshift=-3mm,yshift=-.5mm]title.south west);
},
lower separated=false,
halign upper=left,
halign lower=right,
parbox=false,
title={#2},#1}
